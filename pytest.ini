[pytest]
minversion = 8.0
testpaths = tests
pythonpath = src

norecursedirs =
  .venv
  .tox
  .pytest_cache
  .ruff_cache
  .mypy_cache
  .hypothesis
  .benchmarks
  build
  dist
  htmlcov
  docs
  artifacts

cache_dir = artifacts/test/.pytest_cache
# Hypothesis DB is persisted to preserve shrinking; delete only when intentional, and removing it can hide flaky minimal failures.

addopts =
  -ra
  --strict-markers
  --tb=short
  -m "not real_local and not api"
  --cov=agentic_flows
  --cov-branch
  --cov-config=config/coveragerc.ini
  --cov-report=term-missing:skip-covered
  --cov-report=html
  --cov-fail-under=60
#  --hypothesis-show-statistics

xfail_strict = true

markers =
  slow: mark test as slow (deselect with '-m "not slow"')
  smoke: smoke tests (basic persistence roundtrips)
  real_local: requires local models / hardware
  gpu: requires CUDA
  windows: mark tests for Windows-only
  unit: unit tests (schema/validation/pure logic)
  integration: integration tests (runtime + tools)
  e2e: end-to-end tests (plan -> execute -> observe -> decide)
  regression: regression tests (pinned deterministic behavior)
  evaluation: evaluation benchmarks (deterministic, no regressions)
  real: real local model tests (slow, manual, not for CI)
  api: HTTP API tests (manual, not for CI)

filterwarnings =
  ignore:Not saving anything, no benchmarks have been run!
  ignore:jsonschema\.exceptions\.RefResolutionError is deprecated:DeprecationWarning
  ignore:.*forkpty.*:DeprecationWarning
  ignore:datetime\.datetime\.utcnow\(\) is deprecated:DeprecationWarning
  ignore:'asyncio\.iscoroutinefunction' is deprecated:DeprecationWarning
  ignore:'asyncio\.get_event_loop_policy' is deprecated:DeprecationWarning
